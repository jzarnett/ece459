\input{configuration}

\title{Lecture 35 --- DevOps, but Operations }

\author{Patrick Lam \& Jeff Zarnett \\ \small \texttt{patrick.lam@uwaterloo.ca} \texttt{jzarnett@uwaterloo.ca}}
\institute{Department of Electrical and Computer Engineering \\
  University of Waterloo}
\date{\today}


\begin{document}

\begin{frame}
  \titlepage

 \end{frame}


\begin{frame}
\frametitle{Devops, but Operations}

Services are doing The Thing -- but how do we know if there's a problem?

Monitoring and Alerting.

\begin{center}
	\includegraphics[width=0.8\textwidth]{images/adama.jpg}
\end{center}
``Action stations. Set Condition 1 throughout the ship!''
\end{frame}


\begin{frame}
\frametitle{What to Monitor?}

What to monitor and what to do about it?

Applications have health checks, but how basic should they be?

Maybe automate testing the basic workflow.

These don't show performance problems.

\end{frame}


\begin{frame}
\frametitle{What To Monitor, For Real?}


\begin{itemize}
	\item CPU Load
	\item Memory Utilization
	\item Disk Space
	\item Disk I/O
	\item Network Traffic
	\item Clock Skew
	\item Queue lengths
	\item Application Response Times
\end{itemize}

\end{frame}


\begin{frame}
\frametitle{Overview and Summary}

It would be good to have a dashboard of some sort.

It's a little late to recommend you take a course in the future...

Dashboards are cool but shouldn't be used to identify alerts.

\end{frame}


\begin{frame}
\frametitle{Alert Conditions}

\begin{itemize}
	\item CPU usage exceeding threshold for a certain period of time
	\item Increased rate of error logs over a period of time
	\item A service has restarted many times recently
	\item Queue length very long
	\item Taking too long to complete a workflow
\end{itemize}

\end{frame}


\begin{frame}
\frametitle{Interpreting Alerts}

\begin{center}
	\includegraphics[width=\textwidth]{images/whyyelling.png}
\end{center}


\end{frame}




\begin{frame}
\frametitle{Sir Arthur Conan Doyle Nerdery}

\begin{center}
	\includegraphics[width=0.8\textwidth]{images/more-sherlock.jpg}
\end{center}

Remember also the lesson from Sherlock Holmes in ``The Adventure of Silver Blaze'' -- the dog that did \alert{not} bark was a clue as to who did the crime.

\end{frame}


\begin{frame}
\frametitle{Customer Support}

The final option for detecting a problem is customer support.

Automated monitoring maybe can't find everything every time, but we shouldn't be relying on this as the primary mechanism.


\end{frame}


\begin{frame}
\frametitle{Red Alert}


\begin{itemize}
\item {\bf Alerts}: a human must take action now;
\item {\bf Tickets}: a human must take action soon \\ \qquad (hours or days);
\item {\bf Logging}: no need to look at this \\ \qquad except for forensic/diagnostic purposes.
\end{itemize}


Common bad situation: logs-as-tickets.
\end{frame}



\begin{frame}
\frametitle{Alerting}

 We usually talk about it in the metaphor of pagers, as in the small rectangular box that wakes up doctors when patients need them.
 
 \begin{center}
	\includegraphics[width=0.4\textwidth]{images/pager.jpg}
\end{center}

The alert may contain some information about the event that has caused it.

Example: Service $A$ CPU usage is high.

\end{frame}


\begin{frame}
\frametitle{Beep Beep}

\large

What do you do when you hear the fire alarm?

\end{frame}


\begin{frame}
\frametitle{Back to Sleep}

We have experienced too many false alarms.


If there is an actual fire, you will not only be wrong, you might also be dead.
\end{frame}


\begin{frame}
\frametitle{Not the Kittens!!!}

Alerts and tickets are a great way to make user pain into developer pain.

Some SUPER CRITICAL ticket OMG KITTENS ARE ENDANGERED is an excellent way to learn the lesson... 

Devs will take steps that keep these things from happening in the future.
\end{frame}


\begin{frame}
\frametitle{Incident Reports}

Learning from incidents requires reports (post-mortems).

Identify root causes and what we can learn. 

Reports are worth doing even if they aren't fun.

\end{frame}


\begin{frame}
\frametitle{Report Content}

Breakdown of what happened with timeline.

What happened, when it was noticed, actions taken, when it was resolved.

\begin{center}
	\includegraphics[width=0.3\textwidth]{images/just-the-facts.jpg}
\end{center}


\end{frame}


\begin{frame}
\frametitle{Root Cause Analysis}

There are two kinds of causes: root causes and proximate causes.

Example: deadlock.

How far do we go in terms of finding the root cause?

\end{frame}


\begin{frame}
\frametitle{Toyota Methodology: Five Whys}

Toyota model: ask ``why?'' five times to get to the root cause.

Does not have to be exactly 5; use judgement.

Too few times $\rightarrow$ superficial answers.

Too many times $\rightarrow$ ``computers were a mistake.''

\end{frame}


\begin{frame}
\frametitle{Action Items}

What will we do in the short term and long term?

Prevent this from happening again.

\begin{center}
	\includegraphics[width=0.3\textwidth]{images/smokeybear.jpg}
\end{center}

\end{frame}



\begin{frame}
\frametitle{Be Realistic}

Action items have to be realistic...\\
\quad Probably cannot say rewrite all code in Rust.

Not every report results in major head-exploding conclusions.

\end{frame}


\begin{frame}
\frametitle{Not Included In Report}

Avoid having:

\begin{itemize}
	\item Irrelevant detail
	\item Speculation
	\item Blaming
	\item Blaming
\end{itemize}


\end{frame}




\begin{frame}
\frametitle{Security, Report to the Bridge}

\begin{center}
	\includegraphics[width=\textwidth]{images/securityteam.jpg}
\end{center}

Having an always-available service accessible over the internet makes security a very big concern.

\end{frame}

\begin{frame}
\frametitle{Risk Enormous}

You can run some program with tons of security vulnerabilities offline and feel that the security problems can be managed. 

When it's online the risk is enormous. 

All kinds of vulnerabilities are a problem, but I'll call out two of them:

Code execution/injection and data leakage (information exposure). 


\end{frame}


\begin{frame}
\frametitle{Abusing Free Services for Fun and Profit}

Real-life attack about abusing free CPU time from cloud providers.

These are there for non-nefarious purposes but can be abused.

Also consider a scenario where attackers use your resources!

\end{frame}


\begin{frame}
\frametitle{Abusing Free Services for Fun and Profit}

Bypass signup limitations, browser scripting.

Mining cryptocurrency -- inefficiently -- but works.


Using \$103~000 of resources produces one coin worth about \$137: 0.13\% return.\\
\quad Or free money from attacker POV.

\begin{center}
	\includegraphics[width=0.5\textwidth]{images/freerealestate.jpg}
\end{center}

\end{frame}


\begin{frame}
\frametitle{Abusing Free Services for Fun and Profit}

Disguise what is happening: no container called \texttt{mine-crypto-lol}\\
\quad \texttt{linux88884474} instead.

Generate random Github action names.

Spotting crypto mining is easier because it's CPU intensive...\\
\quad What about spyware, sending secrets to extortion rings?


\end{frame}



\begin{frame}
\frametitle{Information Exposure}

Information Exposure is bad for your reputation and expensive.

GDPR infractions get expensive: \url{https://enforcementtracker.com/}

Fines are for things like insufficient technical measures.

\end{frame}


\begin{frame}
\frametitle{Fun Example}

Remember talking about logging in tracing? Logging PII there was a big risk!

An example of a security process backfiring.


\end{frame}



\begin{frame}
\frametitle{Audit This}

There are some companies out there that will check your code for libraries with versions having known security vulnerabilities.

Sadly, when there is an updated version of a library, there may be breaking changes in it...

Checking for vulnerabilities should be an automatic process as part of your build and release procedures. 

\end{frame}


\end{document}

